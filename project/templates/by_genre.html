<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cosy Console - Games by Genre</title>
    <link rel="stylesheet" href="{{url_for('static', filename='css/styles.css')}}">
    <link rel="icon" href="{{url_for('static', filename='favicon.ico')}}">
</head>
<body>
    <header>
        <h1>Cosy Console</h1>
        <nav class="main-nav">
            <a href="/" class="{% if request.path == '/' %}active{% endif %}">☕Home</a> |
            <a href="/catalogue" class="{% if 'catalogue' in request.path %}active{% endif %}">🎮Catalogue</a> |
            <a href="/game/new" class="{% if 'game/new' in request.path %}active{% endif %}">➕Add Game</a> |
            <a href="/wishlist"   class="{% if 'wishlist' in request.path %}active{% endif %}">🤍 Wishlist</a>|
            <a href="/by-genre" class="{% if 'by-genre' in request.path %}active{% endif %}">🎧 Games by Genre</a>
         </nav>
    </header>
    
    <main>
        <h2>Browse by Genre 🎧</h2>
        <p>Find your next advenure by genre! Click any of the genres below to jump straight to the games you love🤍 </p>

        <!-- jump links-->
        <nav class="genre-nav">
            {% for genre in genre_map.keys() %}
                <a href="#{{ genre|replace(' ', '-') }}">{{ genre }}</a>
      {% endfor %}
        </nav>

        <!-- table view similar to catalogue page-->
              {% for genre, games in genre_map.items() %}
                <h3 id="{{genre|replace(' ', '-') }}">
                    {% if genre == 'Action' %}💥{% elif genre == 'Adventure' %}🗺️{% elif genre == 'RPG' %}⚔️{% elif genre == 'Shooter' %}🔫{% elif genre == 'PVP' %}🤝{% elif genre == 'Simulation' %}🖥️{% elif genre == 'Strategy' %}♟️{% else %}🎲{% endif %}
                    {{genre}}

                </h3>

                    {% if games %}
                        <table class="catalogue-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Platform</th>
                                    <th>Status</th>
                                    <th>Details</th>
                                    <th>Delete</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for game in games %}
                                    <tr>
                                        <td> {{game.title}} </td>
                                        <td> {{game.platform}}</td>
                                        <td> {{game.status}}</td>
                                        <td><a href="/game/{{game.id}}">View Details</a></td>
                                        <td>
                                            <button class=" btn delete-btn" data-gameid="{{game.id}}">Delete</button>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="no-games">No games in this genre yet - get adding!🎮</p>
                    {% endif %}
                </section>
            {% endfor %}                          
    </main>

    <footer>
        <p>&copy; 2025 Cosy Console. All rights reserved.🧸</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const deleteButtons = document.querySelectorAll('.delete-btn');

            deleteButtons.forEach((button) => {
                button.addEventListener('click', function() {
                    if (confirm("Are you sure you want to delete this game? :(")) {
                        const gameId = button.getAttribute('data-gameid');
                        fetch(`/games/${gameId}`, {
                            method: 'DELETE'
                        })
                        .then(response => response.json())
                        .then(data => {
                            alert(data.message);
                            const row = button.closest('tr');
                            if (row) {
                                row.remove();
                            }
                        })
                        .catch(error => console.error('Error deleting game:', error));
                    }
                });
            });
        });
    </script>
</body>
</html>