<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> {% if game %} Edit Game{% else %} Add New Game{% endif %} </title>
    <link rel="stylesheet" href="{{url_for('static', filename='css/styles.css')}}">
</head>
<body>
    <header>
        <h1>Cosy Console</h1>
        <nav>
            <a href="/">Home</a> |
            <a href="/games">Catalogue</a> |
        </nav>
    </header>
    <main> 
        <h2>{% if game %} Edit Game{% else %} Add New Game{% endif %}</h2>
        <form id="gameForm" method="post" action="{% if game %}/games/{{ game.id }}{% else %}/games{% endif %}">
            <!-- title field-->
            <label for="title"> Title:</label>
            <input type="text" id="title" name="title" value="{% if game %}{{game.title}}{% endif %}" required>
            <br>
            <!-- platform field-->
            <label for="platform"> Platform:</label>
            <input type="text" id="platform" name="platform" value="{% if game %}{{game.platform}}{% endif %}">
            <br>
            <!-- genre field-->
            <label for="genre"> Genre:</label>
            <input type="text" id="genre" name="genre" value="{% if game %}{{game.genre}}{% endif %}">
            <br>
            <!-- status field-->
            <label for="status"> Status:</label>
            <input type="text" id="status" name="status" value="{% if game %}{{game.status}}{% endif %}">
            <br>
            <!-- description field-->
            <label for="description"> Description:</label>
            <textarea id="description" name="description">{% if game %}{{game.description }}{% endif %}</textarea>
            <br>
            <!-- rating field-->
            <label for="rating"> Rating:</label>
            <input type="number" id="rating" name="rating" step="1"  value="{% if game %}{{game.rating}}{% endif %}">
            <br>

            <!-- submit button-->
            <button type="submit">{% if game %} Update Game {% else %} Add Game {% endif %}</button>
        </form>

        <!-- delete button: only show if editing an existing game-->
        {% if game %}
        <button type="button" id="deleteBtn"> Delete Game</button>
        {% endif %} 
    </main>
    <footer>
        <p>&copy; 2025 Cosy Console. All rights reserved.</p>
    </footer>   

    <script>
        // add event listener for the delete button 
        document.getElementById('deleteBtn').addEventListener('click', function() {
          if (confirm("Are you sure you want to delete this game :( ?")) {
              fetch("/games/{{ game.id }}", {
                  method: 'DELETE'
              })
              .then(response => response.json())
              .then(data => {
                  alert(data.message);
                  // redirect to the homepage or catalogue page after deletion
                  window.location.href = '/';
              })
              .catch(error => console.error("Error deleting game:", error));
          }
      });
    </script>
</body>
</html>